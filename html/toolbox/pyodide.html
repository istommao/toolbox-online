<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.17.0/full/pyodide.js"></script>
</head>

<body>
  <p>Python Dict Format</p>
  <!-- <input id='code' value='x'> -->
  <textarea id='code' style='width: 100%;' rows='6'></textarea>
  <button onclick='evaluatePython()'>Run</button>
  <br>
  <br>
  <div>
    Output:
  </div>

  <textarea id='output' style='min-height: 300px; width: 100%;' disabled></textarea>

  <script>
    const output = document.getElementById("output");
    const code = document.getElementById("code");

    function addToOutput(s) {
      output.value += '>>>' + code.value + '\n' + s + '\n';
    }

    output.value = 'Initializing...\n';
    // init Pyodide
    async function main(){
      await loadPyodide({ indexURL : 'https://cdn.jsdelivr.net/pyodide/v0.17.0/full/' });
      output.value += 'Ready!\n';
    }
    let pyodideReadyPromise = main();

    async function evaluatePython() {
      var payload = code.value;
      var inputdata = `
        import json

        def json_format(data):
            data = data.replace("'", '"')

            data = json.loads(data)

            return json.dumps(data, indent=4, ensure_ascii=False, separators=(',', ': '))

        result = json_format(json.dumps(${payload}))
      `

      await pyodideReadyPromise;
      try {
        let output = await pyodide.runPythonAsync(inputdata);
        let result = await pyodide.globals.get('result');

        addToOutput(result);
      } catch(err) {
        addToOutput(err);
      }
    }
  </script>
</body>

</html>